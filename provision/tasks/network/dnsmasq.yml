- name: Dnsmasq | Configure Network Manager
  ansible.builtin.copy:
    dest: "/etc/NetworkManager/conf.d/dnsmasq.conf"
    content: |
      [main]
      dns=dnsmasq
    mode: "0644"
  become: true
- name: Dnsmasq | Ensure config directory
  ansible.builtin.file:
    path: /etc/NetworkManager/dnsmasq.d
    state: directory
    mode: "0644"
  become: true
- name: Dnsmasq | Configure entry for .lh domain
  ansible.builtin.copy:
    dest: "/etc/NetworkManager/dnsmasq.d/lh.conf"
    content: "address=/lh/127.0.0.1"
    mode: "0644"
  become: true
- name: Dnsmasq | Configure entry for .docker domain
  ansible.builtin.copy:
    dest: "/etc/NetworkManager/dnsmasq.d/docker.conf"
    content: |
      address=/docker/127.0.0.1
      server=/docker.svc.local/172.17.0.1
    mode: "0644"
  become: true
- name: Dnsmasq | Configure entry for .mkbube domain
  ansible.builtin.copy:
    dest: "/etc/NetworkManager/dnsmasq.d/mkube.conf"
    content: "address=/docker/192.168.1.100"
    mode: "0644"
  become: true
- name: Restart network manager
  ansible.builtin.systemd:
    name: "NetworkManager"
    state: restarted
  become: true
